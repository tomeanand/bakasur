/**
 * angular-localForage - Angular service & directive for https://github.com/mozilla/localForage (Offline storage, improved.)
 * @version v0.2.5
 * @link https://github.com/ocombe/angular-localForage
 * @license MIT
 * @author Olivier Combe <olivier.combe@gmail.com>
 */
!function(e,n,t){"use strict";var r=n.module("LocalForageModule",["ng"]);r.provider("$localForage",function(){t.config({name:"lf"}),this.notify={setItem:!1,removeItem:!1};var e=function(e){return t.setDriver(e)};this.setDriver=e;var r=function(){return t.driver()};this.setNotify=function(e,n){this.notify={setItem:e,removeItem:n}},this.config=function(r){return n.isObject(r)?n.isDefined(r.driver)?(t.config(r),e(r.driver)):t.config(r):void 0},this.$get=["$rootScope","$q","$parse",function(i,o,u){var a=this.notify,c={},f=function(){return"localStorageWrapper"===r()?t.config().name+".":""},s=function(n,t,i,o){"InvalidStateError"===n&&"asyncStorage"===r()?e("localStorageWrapper").then(function(){i(t).then(function(e){o.resolve(e)},function(e){o.reject(e)})},function(){o.reject(n)}):o.reject(n)},l=function(e,r){var u=o.defer(),c=arguments;return n.isObject(r)&&n.isDefined(r.$promise)&&delete r.$promise,t.setItem(f()+e,r).then(function(){a.setItem&&i.$broadcast("LocalForageModule.setItem",{key:e,newvalue:r,driver:t.driver()}),u.resolve(r)},function(e){s(e,c,l,u)}),u.promise},d=function(e){var n=o.defer(),r=arguments;return t.getItem(f()+e).then(function(e){n.resolve(e)},function(e){s(e,r,d,n)}),n.promise},v=function(e){var n=t.removeItem(f()+e);return a.removeItem?n.then(function(){i.$broadcast("LocalForageModule.removeItem",{key:e,driver:t.driver()})}):n},m=function(){var e=o.defer(),t=arguments,r=[];return y().then(function(t){n.forEach(t,function(e){r.push(v(e))}),o.all(r).then(function(){e.resolve()})},function(n){s(n,t,clearAll,e)}),e.promise},g=function(e){var n=o.defer(),r=arguments;return t.key(e).then(function(e){n.resolve(e)},function(e){s(e,r,g,n)}),n.promise},h=function(){var e=o.defer(),n=arguments;return t.length().then(function(n){e.resolve(n)},function(t){s(t,n,h,e)}),e.promise},y=function(){var e=o.defer(),n=arguments;return h().then(function(n){for(var t=[],r=[],i=f(),u=0;n>u;u++)t.push(g(u).then(function(e){e&&0===e.indexOf(i)&&r.push(e.substr(i.length,e.length))}));o.all(t).then(function(){e.resolve(r)})},function(t){s(t,n,y,e)}),e.promise},p=function(e,t){if(n.isString(t))t={key:t};else if(!n.isObject(t)||n.isUndefined(t.key))throw"You must defined a key to bind";var r={defaultValue:"",storeName:""};t=n.extend(r,t||{});var i=t.storeName||t.key,o=u(t.key);return d(i).then(function(r){r?o.assign(e,r):t.defaultValue&&l(i,t.defaultValue),n.isDefined(c[t.key])&&c[t.key](),c[t.key]=e.$watch(u(t.key),function(e){n.isDefined(e)&&l(i,e)},!0)})},k=function(e,t,r){r=r||t,u(t).assign(e,null),n.isDefined(c[t])&&(c[t](),delete c[t]),v(r)};return{setDriver:e,driver:r,getDriver:r,setItem:l,set:l,getItem:d,get:d,remove:v,removeItem:v,clear:m,clearAll:m,key:g,getKeyAt:g,getKeys:y,length:h,getLength:h,bind:p,unbind:k}}]}),r.directive("localForage",["$localForage",function(e){return{restrict:"A",link:function(t,r,i){var o=t.$eval(i.localForage);n.isObject(o)&&n.isDefined(o.key)&&n.isDefined(o.storeName)?e.bind(t,o):e.bind(t,i.localForage)}}}])}(window,window.angular,window.localforage);